# راهنمای استفاده از سابتسک و اولویت

## 🚀 قابلیت‌های جدید

### 1. سیستم اولویت‌بندی
تسک‌ها حالا دارای ۴ سطح اولویت هستند:
- **فوری (Urgent)**: برای تسک‌های بحرانی
- **بالا (High)**: برای تسک‌های مهم
- **متوسط (Medium)**: برای تسک‌های معمولی  
- **کم (Low)**: برای تسک‌های غیر ضروری

### 2. سیستم سابتسک
- هر تسک اصلی می‌تواند چندین سابتسک داشته باشد
- سابتسک‌ها دارای اولویت و وضعیت مجزا هستند
- نمایش پیشرفت تسک اصلی بر اساس سابتسک‌ها

### 3. آمار و گزارش‌گیری
- نمایش توزیع اولویت‌ها
- آمار تسک‌های اصلی و سابتسک‌ها
- نرخ تکمیل تسک‌ها

## 📋 نحوه استفاده

### ایجاد تسک جدید با اولویت
1. روی دکمه "تسک جدید" کلیک کنید
2. عنوان و توضیحات تسک را وارد کنید
3. اولویت تسک را از منوی کشویی انتخاب کنید
4. روی "ایجاد تسک" کلیک کنید

### اضافه کردن سابتسک
1. روی دکمه "سابتسک" در تسک مورد نظر کلیک کنید
2. فرم ایجاد سابتسک باز خواهد شد
3. عنوان، توضیحات و اولویت سابتسک را وارد کنید
4. روی "ایجاد سابتسک" کلیک کنید

### مدیریت سابتسک‌ها
- روی فلش کنار تسک اصلی کلیک کنید تا سابتسک‌ها نمایش داده شوند
- هر سابتسک قابلیت‌های مشابه تسک اصلی دارد:
  - تغییر وضعیت
  - ویرایش عنوان و توضیحات
  - تغییر اولویت
  - حذف

### نمایش آمار
- در بالای صفحه، کارت‌های آماری نمایش داده می‌شوند
- توزیع اولویت‌ها و ساختار سلسله مراتبی تسک‌ها قابل مشاهده است

## 🛠️ تنظیمات دیتابیس

### برای دیتابیس‌های موجود:
اگر قبلاً جدول `tasks` را ایجاد کرده‌اید، این کد SQL را اجرا کنید:

```sql
-- اضافه کردن فیلد priority (اولویت)
ALTER TABLE public.tasks 
ADD COLUMN priority text NOT NULL DEFAULT 'medium';

-- اضافه کردن فیلد parent_task_id برای سابتسک
ALTER TABLE public.tasks 
ADD COLUMN parent_task_id uuid;

-- اضافه کردن foreign key constraint برای parent_task_id
ALTER TABLE public.tasks 
ADD CONSTRAINT fk_parent_task 
FOREIGN KEY (parent_task_id) REFERENCES public.tasks(id) ON DELETE CASCADE;

-- اضافه کردن index برای بهتر شدن عملکرد
CREATE INDEX idx_tasks_priority ON public.tasks(priority);
CREATE INDEX idx_tasks_parent_task_id ON public.tasks(parent_task_id);

-- تعریف constraint برای مقادیر مجاز priority
ALTER TABLE public.tasks 
ADD CONSTRAINT chk_priority 
CHECK (priority IN ('low', 'medium', 'high', 'urgent'));
```

### برای دیتابیس‌های جدید:
اگر جدول `tasks` را هنوز ایجاد نکرده‌اید، کد کامل را از فایل `DATABASE_SETUP.md` استفاده کنید.

## 🔧 ساختار فایل‌ها

### تایپ‌های جدید:
```typescript
// اولویت‌های تسک
type TaskPriority = 'low' | 'medium' | 'high' | 'urgent'

// تسک با سابتسک‌ها
interface TaskWithSubtasks extends Task {
  subtasks: Task[]
  subtasksCount: number
  completedSubtasksCount: number
}

// داده‌های ایجاد سابتسک
interface CreateSubtaskData extends Omit<CreateTaskData, 'parent_task_id'> {
  parent_task_id: string
}
```

### کامپوننت‌های جدید:
- `TaskStats`: نمایش آمار تسک‌ها
- `TaskActions`: بروزرسانی شده برای پشتیبانی از سابتسک
- `TaskDemo`: بروزرسانی شده برای انتخاب اولویت

### Hook‌های جدید:
- `useCreateSubtask()`: ایجاد سابتسک
- `useMainTasks()`: دریافت تسک‌های اصلی
- `useSubtasks()`: دریافت سابتسک‌ها
- `useTaskStats()`: دریافت آمار تسک‌ها

## 🎨 ظاهر و رنگ‌بندی

### رنگ‌بندی اولویت‌ها:
- **فوری**: قرمز (bg-red-100 text-red-800)
- **بالا**: نارنجی (bg-orange-100 text-orange-800)
- **متوسط**: زرد (bg-yellow-100 text-yellow-800)
- **کم**: سبز (bg-green-100 text-green-800)

### نمایش سلسله مراتبی:
- تسک‌های اصلی: بدون تورفتگی
- سابتسک‌ها: با تورفتگی و رنگ‌بندی متفاوت
- نمایش پیشرفت: تعداد سابتسک‌های تکمیل شده

## 🔍 نکات مهم

### عملکرد:
- تسک‌ها بر اساس اولویت و تاریخ ایجاد مرتب می‌شوند
- سابتسک‌ها به صورت کش شده و optimistic update می‌شوند
- استفاده از React Query برای مدیریت state

### امنیت:
- Row Level Security (RLS) برای محافظت از داده‌ها
- کاربران فقط تسک‌های خودشان را می‌بینند
- Cascade delete برای حذف سابتسک‌ها

### تجربه کاربری:
- انیمیشن‌های نرم برای باز/بسته شدن سابتسک‌ها
- نمایش loading state در تمام عملیات
- پیام‌های خطای واضح و کاربرپسند

## 🚀 مراحل بعدی (اختیاری)

### قابلیت‌های پیشرفته:
1. **فیلتر و جستجو**: فیلتر بر اساس اولویت و وضعیت
2. **تاریخ سررسید**: اضافه کردن تاریخ سررسید برای تسک‌ها
3. **برچسب‌گذاری**: اضافه کردن برچسب‌ها برای دسته‌بندی
4. **گزارش‌گیری پیشرفته**: نمودار پیشرفت و آمار تفصیلی

### بهبود عملکرد:
1. **Pagination**: برای تسک‌های زیاد
2. **Virtual scrolling**: برای بهبود عملکرد
3. **Offline support**: کار کردن بدون اینترنت

### اتصال به سایر سیستم‌ها:
1. **تقویم**: همگام‌سازی با تقویم Google/Outlook
2. **نوتیفیکیشن**: اعلان‌های Push
3. **اشتراک‌گذاری**: اشتراک‌گذاری تسک‌ها با دیگران

## 🆘 راهنمای عیب‌یابی

### خطاهای رایج:
1. **Select component not found**: مطمئن شوید که @radix-ui/react-select نصب است
2. **Collapsible not working**: مطمئن شوید که @radix-ui/react-collapsible نصب است
3. **Database constraint error**: مطمئن شوید که Migration های دیتابیس اجرا شده‌اند

### بررسی نصب:
```bash
npm ls @radix-ui/react-select
npm ls @radix-ui/react-collapsible
```

### تست عملکرد:
1. تسک جدید با اولویت مختلف ایجاد کنید
2. سابتسک اضافه کنید
3. وضعیت تسک‌ها را تغییر دهید
4. آمار را بررسی کنید

اگر مشکلی پیش آمد، کنسول مرورگر را برای دیدن پیام‌های خطا بررسی کنید.

---

**موفق باشید! 🎉**

حالا تسک منیجر شما از قابلیت‌های پیشرفته‌ای برای مدیریت بهتر کارها برخوردار است. 